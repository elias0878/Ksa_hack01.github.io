<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محلل البيانات الخصوصية</title>
    <style>
        :root {
            --primary: #2ecc71;
            --danger: #e74c3c;
            --dark: #2c3e50;
            --light: #ecf0f1;
        }

        body {
            font-family: 'Tahoma', sans-serif;
            background: var(--dark);
            color: var(--light);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            background: #34495e;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0,0,0,0.3);
        }

        .permission-box {
            background: #27ae60;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 30px;
        }

        .data-section {
            margin: 25px 0;
            padding: 20px;
            background: #2c3e50;
            border-radius: 10px;
        }

        .sensitive-data {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .data-card {
            background: #3b4a5e;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            margin: 10px;
            transition: all 0.3s;
        }

        button.danger {
            background: var(--danger);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .warning {
            color: var(--danger);
            text-align: center;
            padding: 15px;
            border: 2px solid currentColor;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="permission-box">
            <h2>موافقة على تحليل البيانات</h2>
            <p>هذه الأداة لأغراض تعليمية فقط ولا تخزن أي بيانات</p>
            <button onclick="startDataCollection()">✅ أوافق على البدء</button>
            <button class="danger" onclick="deleteAllData()">❌ حذف كل البيانات</button>
        </div>

        <div class="warning" id="warningMessage"></div>

        <div class="data-section" id="emailSection">
            <h3>📧 عناوين البريد الإلكتروني</h3>
            <div class="sensitive-data" id="emailList"></div>
        </div>

        <div class="data-section" id="phoneSection">
            <h3>📱 أرقام الهواتف</h3>
            <div class="sensitive-data" id="phoneList"></div>
        </div>

        <div class="data-section" id="otherDataSection">
            <h3>🔍 بيانات أخرى محتملة</h3>
            <div class="sensitive-data" id="otherDataList"></div>
        </div>
    </div>

    <script>
        // تعبيرات عادية لاكتشاف البيانات الحساسة
        const patterns = {
            email: /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g,
            phone: /\b(?:\+?966|0)?5[0-9]{8}\b/g,
            token: /\b[a-f0-9]{32,}\b/gi,
            creditCard: /\b(?:\d[ -]*?){13,16}\b/g
        };

        async function startDataCollection() {
            try {
                // طلب إذن الوصول
                const hasPermission = await requestCookiePermission();
                if (!hasPermission) return;

                // جمع البيانات وتحليلها
                const cookies = parseCookies();
                const sensitiveData = analyzeData(cookies);

                // عرض النتائج
                displayResults(sensitiveData);
            } catch (error) {
                showWarning('حدث خطأ في جمع البيانات!');
            }
        }

        async function requestCookiePermission() {
            return new Promise((resolve) => {
                const warning = document.getElementById('warningMessage');
                try {
                    // محاولة قراءة كوكيز لتفعيل طلب الإذن
                    const test = document.cookie;
                    resolve(true);
                } catch (error) {
                    warning.innerHTML = 'تم رفض الوصول! يرجى تفعيل الإذن يدويًا في إعدادات المتصفح';
                    resolve(false);
                }
            });
        }

        function parseCookies() {
            return document.cookie.split(';').reduce((acc, cookie) => {
                const [name, value] = cookie.split('=').map(s => s.trim());
                acc[name] = decodeURIComponent(value);
                return acc;
            }, {});
        }

        function analyzeData(cookies) {
            const results = {
                emails: new Set(),
                phones: new Set(),
                tokens: new Set(),
                creditCards: new Set(),
                others: []
            };

            Object.entries(cookies).forEach(([name, value]) => {
                // البحث عن إيميلات
                const foundEmails = value.match(patterns.email);
                if (foundEmails) foundEmails.forEach(e => results.emails.add(e));

                // البحث عن أرقام هواتف
                const foundPhones = value.match(patterns.phone);
                if (foundPhones) foundPhones.forEach(p => results.phones.add(p));

                // البحث عن بيانات حساسة أخرى
                if (patterns.token.test(value)) results.tokens.add(value);
                if (patterns.creditCard.test(value)) results.creditCards.add(value);
                
                // بيانات عامة
                if (value.length > 40 && !results.tokens.has(value)) {
                    results.others.push({ name, value: value.slice(0, 30) + '...' });
                }
            });

            return results;
        }

        function displayResults(data) {
            displaySection('emailList', Array.from(data.emails));
            displaySection('phoneList', Array.from(data.phones));
            displayOtherData(data);
        }

        function displaySection(containerId, items) {
            const container = document.getElementById(containerId);
            container.innerHTML = items.length > 0 
                ? items.map(i => `<div class="data-card">${i}</div>`).join('')
                : '<div class="data-card">لا توجد بيانات</div>';
        }

        function displayOtherData(data) {
            const container = document.getElementById('otherDataList');
            const items = [
                ...Array.from(data.tokens).map(t => ({ name: 'Token', value: t })),
                ...Array.from(data.creditCards).map(c => ({ name: 'Credit Card', value: c })),
                ...data.others
            ];
            
            container.innerHTML = items.length > 0 
                ? items.map(i => `
                    <div class="data-card">
                        <strong>${i.name}:</strong> 
                        <span>${i.value}</span>
                    </div>
                `).join('')
                : '<div class="data-card">لا توجد بيانات حساسة أخرى</div>';
        }

        function deleteAllData() {
            document.cookie.split(';').forEach(cookie => {
                const [name] = cookie.split('=');
                document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;
            });
            location.reload();
        }

        function showWarning(message) {
            document.getElementById('warningMessage').textContent = message;
        }
    </script>
</body>
</html>
